<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LVM基础知识 &mdash; Learning 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Learning 0.9 documentation" href="index.html" />
    <link rel="next" title="samba集成Active Directory" href="samba_ads.html" />
    <link rel="prev" title="邮件系统-Postfix, Dovecot, MySQL和Postfixadmin" href="mail.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Learning</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="learning.html">学习方法与态度</a></li>
<li class="toctree-l1"><a class="reference internal" href="firefox.html">Speed Up Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="bash.html">Learning Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="tmux.html">tmux</a></li>
<li class="toctree-l1"><a class="reference internal" href="matplot.html">Learning Matplot Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="gnuplot.html">Introduce to the GNUPlot</a></li>
<li class="toctree-l1"><a class="reference internal" href="github.html">使用GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="gentoo.html">Gentoo点滴</a></li>
<li class="toctree-l1"><a class="reference internal" href="freebsd.html">FreeBSD点滴</a></li>
<li class="toctree-l1"><a class="reference internal" href="datamining.html">学习数据挖掘</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpm.html">RPM软件包</a></li>
<li class="toctree-l1"><a class="reference internal" href="vim.html">VIM Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="php.html">PHP点滴</a></li>
<li class="toctree-l1"><a class="reference internal" href="nginx_directive.html">Nginx指令介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediawiki.html">MediaWiki点滴</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">docker使用小记</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">邮件系统-Postfix, Dovecot, MySQL和Postfixadmin</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">LVM基础知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba_ads.html">samba集成Active Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba_basic.html">Samba</a></li>
<li class="toctree-l1"><a class="reference internal" href="disk_quota.html">磁盘配额管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="yslow.html">Best Practices for Speeding Up Your Web Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_header.html">HTTP Header</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="kernel.html">学习内核相关知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="lsp01.html">Linux系统编程（一） IO基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="epoll_man.html">epoll(7)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sql.html">Learning SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_io_benchmark.html">测试MySQL服务器性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_master_slave.html">MySQL配置Master-Slave</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_high_availability.html">MySQL的高可用方案（一）</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_privileges.html">MySQL权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_backup.html">MySQL数据库的备份</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongodb.html">MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_logs.html">MySQL日志相关服务器变量</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_optimize.html">MySQL优化-《高性能MySQL》笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_tuning.html">MySQL通用调优原则</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_key.html">MySQL中的索引-读书笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_status.html">MySQL服务器状态</a></li>
<li class="toctree-l1"><a class="reference internal" href="mysql_replication.html">MySQL复制</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="secure_task.html">运维常用工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="tcp-wrappers.html">简易防火墙TCP-Wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="selinux.html">探索SELinux</a></li>
<li class="toctree-l1"><a class="reference internal" href="intrusion.html">入侵检测与响应</a></li>
<li class="toctree-l1"><a class="reference internal" href="penetration-testing.html">渗透测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="snort.html">入侵检测工具－Snort</a></li>
<li class="toctree-l1"><a class="reference internal" href="openvas.html">学习弱点扫描工具-openVAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="jail.html">如何让特定用户通过SSH登陆后自动chroot？</a></li>
<li class="toctree-l1"><a class="reference internal" href="logfilter.html">Apache日志过滤－是否可以用来预防DDOS</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zabbix.html">配置Zabbix</a></li>
<li class="toctree-l1"><a class="reference internal" href="net-snmp.html">Net-SNMP使用心得</a></li>
<li class="toctree-l1"><a class="reference internal" href="puppet.html">配置管理工具-Puppet</a></li>
<li class="toctree-l1"><a class="reference internal" href="foreman.html">Nginx+Foreman+Passenger</a></li>
<li class="toctree-l1"><a class="reference internal" href="nagios.html">监控工具-Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="proc.html">文件系统/proc</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jenkins.html">赤兔项目持续集成系统－Jenkins CI部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="svn.html">SVN Q/A</a></li>
<li class="toctree-l1"><a class="reference internal" href="svn_mirror.html">SVN仓库安全之镜像备份</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sscanf.html">一个字符引发的问题 - sscanf</a></li>
<li class="toctree-l1"><a class="reference internal" href="unicode.html">折磨人的字符编码问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="comm_pipe.html">命令行管道编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="libpcap.html">抓包-libpcap</a></li>
<li class="toctree-l1"><a class="reference internal" href="libevent.html">Learning libevent Programming</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="python.html">Learning Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="spider.html">爬虫框架 - scrapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymysql.html">Python-MySQL使用心得</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_network.html">Python网络库的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_evolution.html">Code Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_var.html">Pyhton中变量的作用域</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="children.html">小孩教育</a></li>
<li class="toctree-l1"><a class="reference internal" href="song.html">知足</a></li>
<li class="toctree-l1"><a class="reference internal" href="holdteam.html">保持团队稳定</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_finace.html">神仙打架-互联网金融</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">LVM基础知识</a><ul>
<li><a class="reference internal" href="#id1">基本概念</a></li>
<li><a class="reference internal" href="#id2">构建LVM</a></li>
<li><a class="reference internal" href="#pv">PV管理</a><ul>
<li><a class="reference internal" href="#id3">创建</a></li>
<li><a class="reference internal" href="#pv-pe">查看PV/PE</a></li>
<li><a class="reference internal" href="#id4">增加物理卷</a></li>
<li><a class="reference internal" href="#id5">移除物理卷</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vg">卷组(VG)管理</a><ul>
<li><a class="reference internal" href="#id6">创建VG</a></li>
<li><a class="reference internal" href="#id7">查看VG信息</a></li>
<li><a class="reference internal" href="#id8">分割合并卷组</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lv">逻辑卷(LV)管理</a><ul>
<li><a class="reference internal" href="#id9">创建LV</a></li>
<li><a class="reference internal" href="#id10">查看LV属性</a></li>
<li><a class="reference internal" href="#id11">线性逻辑卷</a></li>
<li><a class="reference internal" href="#id12">条状逻辑卷</a></li>
<li><a class="reference internal" href="#id13">镜像逻辑卷</a></li>
<li><a class="reference internal" href="#id14">快照卷</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">LVM重要操作</a><ul>
<li><a class="reference internal" href="#id16">使用LVM来构建系统</a></li>
<li><a class="reference internal" href="#id17">调整LV（逻辑分区）大小</a></li>
<li><a class="reference internal" href="#id18">增加或更换磁盘</a></li>
<li><a class="reference internal" href="#id19">利用快照卷进行在线备份</a></li>
<li><a class="reference internal" href="#id20">性能问题</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">参考资料</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="mail.html" title="Previous Chapter: 邮件系统-Postfix, Dovecot, MySQL和Postfixadmin"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; 邮件系统-Postfix, Do...</span>
    </a>
  </li>
  <li>
    <a href="samba_ads.html" title="Next Chapter: samba集成Active Directory"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">samba集成Active Di... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">LVM基础知识</a><ul>
<li><a class="reference internal" href="#id1">基本概念</a></li>
<li><a class="reference internal" href="#id2">构建LVM</a></li>
<li><a class="reference internal" href="#pv">PV管理</a><ul>
<li><a class="reference internal" href="#id3">创建</a></li>
<li><a class="reference internal" href="#pv-pe">查看PV/PE</a></li>
<li><a class="reference internal" href="#id4">增加物理卷</a></li>
<li><a class="reference internal" href="#id5">移除物理卷</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vg">卷组(VG)管理</a><ul>
<li><a class="reference internal" href="#id6">创建VG</a></li>
<li><a class="reference internal" href="#id7">查看VG信息</a></li>
<li><a class="reference internal" href="#id8">分割合并卷组</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lv">逻辑卷(LV)管理</a><ul>
<li><a class="reference internal" href="#id9">创建LV</a></li>
<li><a class="reference internal" href="#id10">查看LV属性</a></li>
<li><a class="reference internal" href="#id11">线性逻辑卷</a></li>
<li><a class="reference internal" href="#id12">条状逻辑卷</a></li>
<li><a class="reference internal" href="#id13">镜像逻辑卷</a></li>
<li><a class="reference internal" href="#id14">快照卷</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">LVM重要操作</a><ul>
<li><a class="reference internal" href="#id16">使用LVM来构建系统</a></li>
<li><a class="reference internal" href="#id17">调整LV（逻辑分区）大小</a></li>
<li><a class="reference internal" href="#id18">增加或更换磁盘</a></li>
<li><a class="reference internal" href="#id19">利用快照卷进行在线备份</a></li>
<li><a class="reference internal" href="#id20">性能问题</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">参考资料</a></li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="_sources/lvm.txt"
     rel="nofollow">Source</a>
</div>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="lvm">
<h1>LVM基础知识<a class="headerlink" href="#lvm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>基本概念<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>如果我们单块磁盘最大容量为1TB，但是有一个数据库文件有5个TB怎么办？在<strong>分区</strong>这个概念下是无法做到的，我们无法将小的分区（文件系统）合在一起使用。LVM可以做到，
前面也介绍过，LVM中的LV（逻辑卷）与物理磁盘的大小是完全无关的，可以将不同大小的物理盘合并到一起最终构建一个大的LV，那要怎么去实现呢，下面我们将介绍。</p>
<p>使用LVM(Logic Volume Manager)可以灵活方便的管理物理磁盘。你是否遇到某个磁盘分区空间不足，给你的文档存放规范带来不便。使用LVM可以轻松的解决这个问题。逻辑卷实际上是将物理磁盘虚拟化，这样逻辑卷的大小就不受物理卷大小的限制。并且它还有其它优点：</p>
<ol class="arabic simple">
<li><em>灵活的容量</em> 当使用逻辑卷时，可在多个磁盘间扩展文件系统，因为您可以将磁盘和分区集合成一个逻辑卷。</li>
<li><em>重新设定存储池大小</em> 您可以使用检单的软件命令增大或者减小逻辑卷的大小，而无需对所在磁盘设备重新格式化或者重新分区。</li>
<li><em>在线数据重新定位</em> 要部署更新、更快或者更有弹性的存储子系统，以便您可以在系统活跃时移动数据。数据可以在磁盘正在使用时进行重新分配。例如，您可以在删除一个热交换磁盘之前将其清空。</li>
<li><em>方便设备命名</em> 逻辑存储卷可在用户定义的组群中进行管理，这些组群可按您的要求进行命名。</li>
<li><em>磁盘条带</em> 您可以创建一个可在两个或者更多磁盘间条状分布数据的逻辑卷。这可大幅度提高吞吐量。</li>
<li><em>镜像卷</em> 逻辑卷为您提供了一个方便配置数据镜像的方法。</li>
<li><em>卷快照</em> 使用逻辑卷，您可以提取设备快照，这样可在持续备份或者在不影响真实数据的情况下测试修改效果。</li>
</ol>
<p>使用LVM需要掌握几个新的概念：<tt class="docutils literal"><span class="pre">物理卷，卷组，逻辑卷</span></tt>。对详细说明请参考参考资料中列出的内容。</p>
</div>
<div class="section" id="id2">
<h2>构建LVM<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>简单流程：</p>
<ul class="simple">
<li>使用命令 <tt class="docutils literal"><span class="pre">pvcreate</span></tt>创建<tt class="docutils literal"><span class="pre">PE</span></tt></li>
<li>使用命令 <tt class="docutils literal"><span class="pre">vgcreate</span></tt>创建<tt class="docutils literal"><span class="pre">VG</span></tt></li>
<li>使用命令 <tt class="docutils literal"><span class="pre">lvcreate</span></tt>创建<tt class="docutils literal"><span class="pre">LV</span></tt></li>
</ul>
<p>再用<tt class="docutils literal"><span class="pre">mkfs</span></tt>格式化LV，即可以使用LV存储文件数据了。</p>
<p>一个新的磁盘（存储器）插入到系统后会被识别为一个新的独立的文件系统，这类似于我们将一块大磁盘分割为几个小的文件系统（比如windows下经常分的C, D, E......等等分区）。如果你想将一个小的文件系统加入到LVM中，首先需要在这个小的文件系统上建立PE(physical extend)，命令：<tt class="docutils literal"><span class="pre">pvcreate</span></tt>。</p>
</div>
<div class="section" id="pv">
<h2>PV管理<a class="headerlink" href="#pv" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>相关命令有：</dt>
<dd>pvchange   pvcreate   pvmove     pvresize   pvscan
pvck       pvdisplay  pvremove   pvs</dd>
</dl>
<div class="section" id="id3">
<h3>创建<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>使用命令<tt class="docutils literal"><span class="pre">pvcreate</span></tt>创建PE，<tt class="docutils literal"><span class="pre">pvcreate</span></tt>的操作会破坏原分区（文件系统）中的数据。</p>
<div class="highlight-bash"><div class="highlight"><pre>pvcreate /dev/sda1 /dev/sda2 /dev/sda3
<span class="c"># pvcreate后接分区，即可在分区上创建PE</span>
</pre></div>
</div>
</div>
<div class="section" id="pv-pe">
<h3>查看PV/PE<a class="headerlink" href="#pv-pe" title="Permalink to this headline">¶</a></h3>
<p>命令<tt class="docutils literal"><span class="pre">pvdisplay</span></tt>可以用来查看已创建PE的PV（物理卷）的属性，如，大小，PE大小，所属VG等等。例如：</p>
<ol class="arabic simple">
<li>默认使用选项-v，显示详细信息</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre>pvdisplay <span class="o">[</span>-v<span class="o">]</span>
<span class="c">#   Scanning for physical volume names</span>
<span class="c"># --- Physical volume ---</span>
<span class="c"># PV Name               /dev/sda10</span>
<span class="c"># VG Name               vg</span>
<span class="c"># PV Size               972.65 MiB / not usable 4.65 MiB</span>
<span class="c"># Allocatable           yes</span>
<span class="c"># PE Size               4.00 MiB</span>
<span class="c"># Total PE              242</span>
<span class="c"># Free PE               61</span>
<span class="c"># Allocated PE          181</span>
<span class="c"># PV UUID               fGisVN-LA7s-MPJW-F5ZI-gYqC-SS0O-UPNzPI</span>
<span class="c">#</span>
<span class="c"># --- Physical volume ---</span>
<span class="c"># PV Name               /dev/sda11</span>
<span class="c"># VG Name               vg</span>
<span class="c"># PV Size               972.65 MiB / not usable 4.65 MiB</span>
<span class="c"># Allocatable           yes</span>
<span class="c"># PE Size               4.00 MiB</span>
<span class="c"># Total PE              242</span>
<span class="c"># Free PE               223</span>
<span class="c"># Allocated PE          19</span>
<span class="c"># PV UUID               I0HjTy-Bcjf-oZG1-4hTR-CxVq-vHF1-DTvzyn</span>
<span class="c">#</span>
<span class="c"># &quot;/dev/sda9&quot; is a new physical volume of &quot;972.65 MiB&quot;</span>
<span class="c"># --- NEW Physical volume ---</span>
<span class="c"># PV Name               /dev/sda9</span>
<span class="c"># VG Name</span>
<span class="c"># PV Size               972.65 MiB</span>
<span class="c"># Allocatable           NO</span>
<span class="c"># PE Size               0</span>
<span class="c"># Total PE              0</span>
<span class="c"># Free PE               0</span>
<span class="c"># Allocated PE          0</span>
<span class="c"># PV UUID               dhL0cH-wS6w-dscI-PXRv-dRLS-aXaN-tzn08w</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>也可以使用选项“ <tt class="docutils literal"><span class="pre">-s|--short</span></tt>“显示精简信息。如：</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre>pvdisplay -s
<span class="c"># Device &quot;/dev/sda10&quot; has a capacity of 244.00 MiB</span>
<span class="c"># Device &quot;/dev/sda11&quot; has a capacity of 892.00 MiB</span>
<span class="c"># Device &quot;/dev/sda9&quot; has a capacity of 972.65 MiB</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>也显示指定分区的信息。</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre>pvdisplay <span class="o">[</span>option<span class="o">]</span> &lt;pv_path&gt;
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>增加物理卷<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>如果你存放数据的文件系统，随着数据增加，空间不够，需要增加磁盘，怎么把新的磁盘空间增加到原来的文件系统中呢？</p>
<p>确认*/dev*目录下可以发现新加磁盘，然后使用<tt class="docutils literal"><span class="pre">fdisk</span></tt>命令将新磁盘分区（亦可不分）。</p>
<p>最后用<tt class="docutils literal"><span class="pre">pvcreate</span> <span class="pre">*PhysicalVolume*</span></tt>在新磁盘上建立PV。</p>
</div>
<div class="section" id="id5">
<h3>移除物理卷<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>如果需要更换某个磁盘，那怎么办呢？</p>
</div>
</div>
<div class="section" id="vg">
<h2>卷组(VG)管理<a class="headerlink" href="#vg" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>相关命令有:</dt>
<dd>vgcreate, vgs, vgdisplay
vgreduce, vgextend, vgremove, vgexport, vgimport
vgmerge, vgsplit等等</dd>
</dl>
<div class="section" id="id6">
<h3>创建VG<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>当完成创建PE之后就可以在相应的分区上建立VG了。使用命令<tt class="docutils literal"><span class="pre">vgcreate</span></tt>来创建VG，如：</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># 创建一个VG，其名字为vgName。</span>
vgcreate vg-test /dev/sda9
<span class="c"># Volume group &quot;vg-test&quot; successfully created</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">1.  VG可以使用多个分区，也正是因为这样，LVM才能把多个小的分区（文件系统）联合起
来形成一个大的文件系统
2.  另外，一个分区只能属于一个VG</p>
</div>
</div>
<div class="section" id="id7">
<h3>查看VG信息<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>与查看PV/PE信息一样，使用命令<tt class="docutils literal"><span class="pre">vgdisplay</span></tt>来查看VG的信息。例如：</p>
<div class="highlight-bash"><div class="highlight"><pre>vgdisplay
<span class="c">#  --- Volume group ---</span>
<span class="c">#  VG Name               vg</span>
<span class="c">#  System ID</span>
<span class="c">#  Format                lvm2</span>
<span class="c">#  Metadata Areas        2</span>
<span class="c">#  Metadata Sequence No  26</span>
<span class="c">#  VG Access             read/write</span>
<span class="c">#  VG Status             resizable</span>
<span class="c">#  MAX LV                0</span>
<span class="c">#  Cur LV                5</span>
<span class="c">#  Open LV               1</span>
<span class="c">#  Max PV                0</span>
<span class="c">#  Cur PV                2</span>
<span class="c">#  Act PV                2</span>
<span class="c">#  VG Size               1.89 GiB</span>
<span class="c">#  PE Size               4.00 MiB</span>
<span class="c">#  Total PE              484</span>
<span class="c">#  Alloc PE / Size       200 / 800.00 MiB</span>
<span class="c">#  Free  PE / Size       284 / 1.11 GiB</span>
<span class="c">#  VG UUID               DXKStQ-rGBh-kVSa-PDy2-eFvg-FLAx-kELRZX</span>
</pre></div>
</div>
<p>可以查看到卷组vg的相关信息，其中大部分都可以在创建VG时设定，不过一般我们都会使用默认值，除非你有特殊的要求。</p>
<p>其实查看PE, VG的信息还有其它命令<tt class="docutils literal"><span class="pre">pvs,</span> <span class="pre">vgs</span></tt>，这两个命令主要用于生成报告信息，便于SA了解所需的信息。</p>
</div>
<div class="section" id="id8">
<h3>分割合并卷组<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="lv">
<h2>逻辑卷(LV)管理<a class="headerlink" href="#lv" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>相关命令:</dt>
<dd>lvcreate, lvresize, lvextend, lvreduce, lvremove等等</dd>
</dl>
<p>逻辑卷类似于系统中的分区/dev/sda1, /dev/sda2等等，是用来存储数据的。</p>
<div class="section" id="id9">
<h3>创建LV<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>与创建PE，VG类似，创建LV使用命令<tt class="docutils literal"><span class="pre">lvcreate</span></tt>来创建LV。创建一个分区当然要指明这个分区的大小了，还要给一个名字便于查找使用。</p>
<div class="highlight-bash"><div class="highlight"><pre>lvcreate -L +200M -n lv-test vg-test
</pre></div>
</div>
<p>上面的命令将在卷组vg-test中创建一个名为lv-test，200M大小的LV。选项*-L*后接LV的大小，单位可以是K(b), M(b), T(b), P(b), E(b)；选项*-n*后接LV的名称，最后为已存在的 VG名称（即要在哪个VG上建立LV）。</p>
</div>
<div class="section" id="id10">
<h3>查看LV属性<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>使用命令<tt class="docutils literal"><span class="pre">lvdisplay</span></tt>来查看LV的相关信息。用法与<tt class="docutils literal"><span class="pre">pvdisplay,</span> <span class="pre">vgdisplay</span></tt>类似。如：</p>
<div class="highlight-bash"><div class="highlight"><pre>lvdisplay /dev/vg/vg-test
<span class="c">#  --- Logical volume ---</span>
<span class="c">#  LV Name                /dev/vg/vg-test</span>
<span class="c">#  VG Name                vg</span>
<span class="c">#  LV UUID                DwWf1w-0UMN-61WD-rHF1-pZtM-uec5-z7mGQW</span>
<span class="c">#  LV Write Access        read/write</span>
<span class="c">#  LV Status              available</span>
<span class="c">#  # open                 1</span>
<span class="c">#  LV Size                500.00 MiB</span>
<span class="c">#  Current LE             125</span>
<span class="c">#  Segments               1</span>
<span class="c">#  Allocation             inherit</span>
<span class="c">#  Read ahead sectors     auto</span>
<span class="c">#  - currently set to     256</span>
<span class="c">#  Block device           253:9</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>线性逻辑卷<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id12">
<h3>条状逻辑卷<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id13">
<h3>镜像逻辑卷<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id14">
<h3>快照卷<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id15">
<h2>LVM重要操作<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id16">
<h3>使用LVM来构建系统<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id17">
<h3>调整LV（逻辑分区）大小<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p><strong>情 境</strong>：挂载于/usr下的分区LV（逻辑分区）lv_usr空间快被消耗殆尽，怎么办？</p>
<p><strong>解决步骤</strong>：</p>
<ul>
<li><p class="first">确认VG（卷组）是否有足够的剩余空间。如果剩余空间不足，可以缩小其它剩余空间较
多的LV，也可以增加新磁盘</p>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">lvresize</span></tt>增加<em>lv_usr</em>空间</p>
<div class="highlight-bash"><div class="highlight"><pre>lvresize -L +increaseNumber /dev/VolGroup/lv_usr
</pre></div>
</div>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">resize2fs</span></tt>扩大逻辑分区<em>lv_usr</em>上的文件系统，使其与分区大
小一致。此时系统可能提示你要先运行<tt class="docutils literal"><span class="pre">fsck</span></tt>检查一下文件系统</p>
<div class="highlight-bash"><div class="highlight"><pre>e2fsck -f /dev/VolGroup/lv_usr
resize2fs /dev/VolGroup/lv_usr
</pre></div>
</div>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">lvs</span></tt>确认扩容成功。</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">关键是：运行<tt class="docutils literal"><span class="pre">lvresize</span></tt>, <tt class="docutils literal"><span class="pre">resize2fs</span></tt>的先后顺序。扩容一定要先运行<tt class="docutils literal"><span class="pre">lvreize</span></tt>扩大分区，再运行<tt class="docutils literal"><span class="pre">resize2fs</span></tt>扩大文件系统</p>
</div>
</div>
<div class="section" id="id18">
<h3>增加或更换磁盘<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>情境：由于某个块磁盘年代比较久远，性能较差，需要更换新的磁盘，利用LVM如何在系统
不停机的情形下更换硬盘？</p>
<p>现在情况为：系统中有一块磁盘/dev/sda，在其上有一个分区/dev/sda1，/dev/sda1为VG（
卷组）VGroup中的P，其中有很多LV</p>
<p>完成步骤：</p>
<ul>
<li><p class="first">将新的硬盘经测试后安装到系统上并进行分区（此处我们假定新磁盘为/dev/sdb1）</p>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">pvcreate</span></tt>将新的磁盘加入到PV（物理卷）</p>
<div class="highlight-bash"><div class="highlight"><pre>pvcreate /dev/sdb1
</pre></div>
</div>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">vgextend</span></tt>将/dev/sdb1加入到卷组VGroup中</p>
<div class="highlight-bash"><div class="highlight"><pre>vgextend VGroup /dev/sdb1
</pre></div>
</div>
</li>
<li><p class="first">在线使用命令<tt class="docutils literal"><span class="pre">pvmove</span></tt>将/dev/sda1上的数据转移/dev/sdb1</p>
<div class="highlight-bash"><div class="highlight"><pre>pvmove /dev/sda1 /dev/sdb1
</pre></div>
</div>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">vgreduce</span></tt>将磁盘/dev/sda1从卷组VGroup中移除</p>
<div class="highlight-bash"><div class="highlight"><pre>vgreduce VGroup /dev/sda1
</pre></div>
</div>
</li>
<li><p class="first">使用命令<tt class="docutils literal"><span class="pre">pvremove</span></tt>将磁盘/dev/sda1从PV中移除</p>
<div class="highlight-bash"><div class="highlight"><pre>pvremove /dev/sda1
</pre></div>
</div>
</li>
<li><p class="first">将原磁盘拆下即可</p>
</li>
</ul>
</div>
<div class="section" id="id19">
<h3>利用快照卷进行在线备份<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id20">
<h3>性能问题<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="id21">
<h2>参考资料<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/lvm.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013, Liu Hui.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>